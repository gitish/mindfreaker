<!DOCTYPE html>
<!-- saved from url=(0061)http://backbonetutorials.com/nodejs-restify-mongodb-mongoose/ -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script type="text/javascript" data-rocketsrc="//s7.addthis.com/static/r07/plugins/layers099.js" data-rocketoptimized="true"></script><script type="text/javascript" data-rocketsrc="//s7.addthis.com/static/r07/menu173.js" data-rocketoptimized="true"></script>

<title>Simple example - Node.js, Restify, MongoDb and Mongoose - Backbone.js Tutorials</title>
<script id="twitter-wjs" data-rocketsrc="http://platform.twitter.com/widgets.js" data-rocketoptimized="true"></script><script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"bb3ef670e564dde12f0ad8dd7674f538",petok:"af17739c4b86dc85fa40ca93482bc8d900ab53d2-1423832309-1800",zone:"backbonetutorials.com",rocket:"a",apps:{}}];document.write('<script type="text/javascript" src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=919620257c/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script><script type="text/javascript" src="./node/cloudflare.min.js"></script><style type="text/css">.cf-hidden { display: none; } .cf-invisible { visibility: hidden; }</style><script data-module="cloudflare/rocket" id="cfjs_block_4bba6a0662" onload="CloudFlare.__cfjs_block_4bba6a0662_load()" onerror="CloudFlare.__cfjs_block_4bba6a0662_error()" onreadystatechange="CloudFlare.__cfjs_block_4bba6a0662_readystatechange()" type="text/javascript" src="./node/rocket.js"></script>
<link href="http://backbonetutorials.com/atom.xml" rel="alternate" title="backbone tutorials" type="application/atom+xml">
<meta name="author" content="Backbone Tutorials">
 
 
<link rel="stylesheet" href="./node/syntax.css" type="text/css">
 
<link rel="stylesheet" href="./node/bootstrap.min.css" type="text/css" media="screen, projection">
<link rel="stylesheet" href="./node/style.css" type="text/css" media="screen, projection">
<link href="./node/css" rel="stylesheet" type="text/css">
 
<script type="text/rocketscript" data-rocketoptimized="true">try{Typekit.load();}catch(e){}</script>
<script type="text/javascript" async="" data-rocketsrc="http://bbtutes.disqus.com/embed.js" data-rocketoptimized="true"></script><script type="text/javascript" async="" data-rocketsrc="http://in.getclicky.com/in.php?site_id=66406579&amp;res=1366x768&amp;lang=en&amp;type=pageview&amp;href=%2Fnodejs-restify-mongodb-mongoose%2F&amp;title=Simple%20example%20-%20Node.js%2C%20Restify%2C%20MongoDb%20and%20Mongoose%20-%20Backbone.js%20Tutorials&amp;ref=https%3A%2F%2Fwww.google.com%2F&amp;jsuid=860184314&amp;mime=js&amp;x=0.11883640824817121" data-rocketoptimized="true"></script><script type="text/javascript" src="./node/in.php"></script><link rel="stylesheet" type="text/css" href="./node/widget014.top.svg.css" media="all"><link rel="stylesheet" type="text/css" href="./node/layers077.css" media="all"><script data-rocketsrc="//a.disquscdn.com/next/alfie.f51946af45e0b561c60f768335c9eb79.js" data-rocketoptimized="true" async="" charset="UTF-8"></script><link rel="stylesheet" type="text/css" href="./node/widget014.svg.css" media="all"><script type="text/javascript" async="" data-rocketsrc="http://in.getclicky.com/in.php?site_id=66406579&amp;type=ping&amp;jsuid=860184314&amp;hmset&amp;mime=js&amp;x=0.6405760799534619" data-rocketoptimized="true"></script><script type="text/javascript" src="./node/in(1).php"></script><script type="text/javascript" async="" data-rocketsrc="http://in.getclicky.com/in.php?site_id=66406579&amp;type=ping&amp;jsuid=860184314&amp;hmset&amp;mime=js&amp;x=0.44491286645643413" data-rocketoptimized="true"></script><script type="text/javascript" src="./node/in(2).php"></script></head>
<body data-twttr-rendered="true"><iframe id="twttrHubFrameSecure" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" name="twttrHubFrameSecure" src="./node/hub.e49de384ce9235929b9e175019bc4213(1).html" style="position: absolute; top: -9999em; width: 10px; height: 10px;"></iframe><iframe id="twttrHubFrame" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" name="twttrHubFrame" src="./node/hub.e49de384ce9235929b9e175019bc4213.html" style="position: absolute; top: -9999em; width: 10px; height: 10px;"></iframe>
<div class="row">
<div class="navbar navbar-default">
<div class="container">
<div class="navbar-header">
<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="http://backbonetutorials.com/">Backbone Tutorials</a>
</div>
<div class="navbar-collapse collapse navbar-responsive-collapse">
<ul class="nav navbar-nav">
<li class=""><a href="http://backbonetutorials.com/">Tutorials</a></li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li class=""><a href="http://jobs.jsonresume.org/" class="translateit">Job Board</a></li>
<li><a href="http://prerender.io/"><strong>Need SEO?</strong></a></li>
<li><a href="https://leanpub.com/backbonetutorials">Download eBook (.pdf, .MOBI, .ePub)</a></li>
</ul>
</div>
</div>
</div>
<div class="container">
<div class="row">
<div class="panel panel-primary">
<div class="panel-heading">
<h3 class="panel-title">About</h3>
</div>
<div class="panel-body">
<div class="col-lg-4">
<p>Backbone Tutorials is a collection of tutorials written by <a href="http://thomasdav.is/">Thomas Davis</a>. Everything is open source and I try my best to keep the tutorials updated. Though I am busy and only work on this is my spare time so many <a href="https://github.com/thomasdavis/backbonetutorials/graphs/contributors">contributors</a> have also help me put this resource together.</p>
<iframe id="twitter-widget-0" scrolling="no" frameborder="0" allowtransparency="true" src="./node/follow_button.a5bbbb7216610af1306d56b0f28a67d7.en.html" class="twitter-follow-button twitter-follow-button" title="Twitter Follow Button" data-twttr-rendered="true" style="width: 258px; height: 20px;"></iframe>
<script type="text/rocketscript" data-rocketoptimized="true">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>
<div class="col-lg-8">
<h3>Backbone.js Beginner Video Tutorial</h3>
<img src="./node/backbone.png" style="float: left;"><p>I have put extra effort into making a very easy to understand Backbone.js video which is also free. It is 70mins long and covers everything you need to know when getting started.</p>
<a href="https://www.youtube.com/watch?v=FZSjvWtUxYk" class="btn btn-primary">Watch Video</a>
</div>
</div>
</div>
</div>
<div id="post">
<h1>Simple example - Node.js, Restify, MongoDb and Mongoose</h1>
<p>Before I start, the Backbone.js parts of this tutorial will be using techniques described in "Organizing your application using <a href="http://backbonetutorials.com/organizing-backbone-using-modules/">Modules</a> to construct a simple guestbook.</p>
<h2>Getting started</h2>
<p>To easily understand this tutorial you should jump straight into the example code base.</p>
<p><a href="https://github.com/thomasdavis/backbonetutorials/tree/gh-pages/examples/nodejs-mongodb-mongoose-restify">Example Codebase</a></p>
<p><a href="http://backbonetutorials.com/examples/nodejs-mongodb-mongoose-restify/app">Example Demo</a></p>
<p>This tutorial will assist you in saving data(Backbone.js Models) to MongoDb and retrieving a list(Backbone.js Collections) of them back.</p>
<h2>The technologies</h2>
<p>This stack is great for rapid prototyping and highly intuitive. Personal note: I love using JavaScript as my only language for the entire application (FrontEnd/BackEnd/API/Database). Restify is still in early development but is essentially just an extension of Express. So for anyone needing more stability you can easily just substitute Express in.</p>
<h3>Node.js</h3>
<p>"Node.js is a platform built on Chrome's JavaScript runtime for easily building fast, scalable network applications. Node.js uses an event-driven, non-blocking I/O model that makes it lightweight and efficient, perfect for data-intensive real-time applications that run across distributed devices."</p>
<h3>Restify</h3>
<p>"Restify is a node.js module built specifically to enable you to build correct REST web services. It borrows heavily from express (intentionally) as that is more or less the de facto API for writing web applications on top of node.js."</p>
<h3>MongoDb</h3>
<p>"MongoDB (from "humongous") is a scalable, high-performance, open source NoSQL database."</p>
<h3>Mongoose</h3>
<p>"Mongoose is a MongoDB object modeling tool designed to work in an asynchronous environment."</p>
<h2>Building the server</h2>
<p>In the example repository there is a server.js example which can be executed by running <code>node server.js</code>. If you use this example in your own applications make sure to update the Backbone.js <a href="https://github.com/thomasdavis/backbonetutorials/blob/gh-pages/examples/nodejs-mongodb-mongoose-restify/js/models/message.js">Model</a> and <a href="https://github.com/thomasdavis/backbonetutorials/blob/gh-pages/examples/nodejs-mongodb-mongoose-restify/js/collections/messages.js">Collection</a> definitions to match your server address.</p>
<h2>Restify configuration</h2>
<p>The first thing to do is require the Restify module. Restify will be in control of handling our restful endpoints and returning the appropriate JSON.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">restify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'restify'</span><span class="p">);</span>  
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">restify</span><span class="p">.</span><span class="nx">createServer</span><span class="p">();</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">restify</span><span class="p">.</span><span class="nx">bodyParser</span><span class="p">());</span></code></pre></div>
<p>Note: bodyParser() takes care of turning your request data into a JavaScript object on the server automatically.</p>
<h2>MongoDb/Mongoose configuration</h2>
<p>We simply want to require the MongoDb module and pass it a MongoDb authentication URI e.g. mongodb://username:server@mongoserver:10059/somecollection</p>
<p>The code below presupposes you have another file in the same directory called <code>config.js</code>. Your config should never be public as it contains your credentials. So for this repository I have added <code>config.js</code> to my <code>.gitignore</code> but added in a <a href="https://github.com/thomasdavis/backbonetutorials/blob/gh-pages/examples/nodejs-mongodb-mongoose-restify/config-sample.js">sample config</a>.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'mongoose/'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./config'</span><span class="p">);</span>
<span class="nx">db</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">creds</span><span class="p">.</span><span class="nx">mongoose_auth</span><span class="p">),</span>
<span class="nx">Schema</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">;</span></code></pre></div>
<h2>Mongoose Schema</h2>
<p>Mongoose introduces a concept of <a href="http://mongoosejs.com/docs/model-definition.html">model/schema</a> enforcing types which allow for easier input validation etc</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Create a schema for our data</span>
<span class="kd">var</span> <span class="nx">MessageSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">({</span>
  <span class="nx">message</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
  <span class="nx">date</span><span class="o">:</span> <span class="nb">Date</span>
<span class="p">});</span>
<span class="c1">// Use the schema to register a model with MongoDb</span>
<span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">'Message'</span><span class="p">,</span> <span class="nx">MessageSchema</span><span class="p">);</span> 
<span class="kd">var</span> <span class="nx">Message</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">model</span><span class="p">(</span><span class="s1">'Message'</span><span class="p">);</span></code></pre></div>
<p><em>Note: <code>Message</code> can now be used for all things CRUD related.</em></p>
<h2>Setting up the routes</h2>
<p>Just like in Backbone, Restify allows you to configure different routes and their associated callbacks. In the code below we define two routes. One for saving new messages and one for retrieving all messages. After we have created our function definitions, we attach them to either GET/POST/PUT/DELETE on a particular restful endpoint e.g. GET /messages</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// This function is responsible for returning all entries for the Message model</span>
<span class="kd">function</span> <span class="nx">getMessages</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Resitify currently has a bug which doesn't allow you to set default headers</span>
  <span class="c1">// This headers comply with CORS and allow us to server our response to any origin</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s2">"Access-Control-Allow-Origin"</span><span class="p">,</span> <span class="s2">"*"</span><span class="p">);</span> 
  <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s2">"Access-Control-Allow-Headers"</span><span class="p">,</span> <span class="s2">"X-Requested-With"</span><span class="p">);</span>
  <span class="c1">// .find() without any arguments, will return all results</span>
  <span class="c1">// the `-1` in .sort() means descending order</span>
  <span class="nx">Message</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">sort</span><span class="p">(</span><span class="s1">'date'</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="nx">execFind</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">arr</span><span class="p">,</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>



<span class="kd">function</span> <span class="nx">postMessage</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s2">"Access-Control-Allow-Origin"</span><span class="p">,</span> <span class="s2">"*"</span><span class="p">);</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s2">"Access-Control-Allow-Headers"</span><span class="p">,</span> <span class="s2">"X-Requested-With"</span><span class="p">);</span>
  <span class="c1">// Create a new message model, fill it up and save it to Mongodb</span>
  <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Message</span><span class="p">();</span>
  <span class="nx">message</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">message</span><span class="p">;</span>
  <span class="nx">message</span><span class="p">.</span><span class="nx">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
  <span class="nx">message</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="c1">// Set up our routes and start the server</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/messages'</span><span class="p">,</span> <span class="nx">getMessages</span><span class="p">);</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/messages'</span><span class="p">,</span> <span class="nx">postMessage</span><span class="p">);</span></code></pre></div>
<p>This wraps up the server side of things, if you follow the <a href="https://github.com/thomasdavis/backbonetutorials/blob/gh-pages/examples/nodejs-mongodb-mongoose-restify/server.js">example</a> then you should see something like</p>
<p><a href="http://backbonetutorials.nodejitsu.com/messages">http://backbonetutorials.nodejitsu.com/messages</a></p>
<p><em>Note: Again you must remember to change the <a href="https://github.com/thomasdavis/backbonetutorials/blob/gh-pages/examples/nodejs-mongodb-mongoose-restify/js/models/message.js">Model</a> and <a href="https://github.com/thomasdavis/backbonetutorials/blob/gh-pages/examples/nodejs-mongodb-mongoose-restify/js/collections/messages.js">Collection</a> definitions to match your server address.</em></p>
<h2>Setting up the client (Backbone.js)</h2>
<p>I've actually used the latest copy of <a href="http://backboneboilerplate.com/">http://backboneboilerplate.com</a> to set up the example page.</p>
<p>The important files you will want to check out are;</p>
<ul>
<li>views/dashboard/page.js</li>
<li>views/guestbook/form.js</li>
<li>views/guestbook/list.js</li>
<li>models/message.js</li>
<li>collections/messages.js</li>
<li>templates/guestbook/</li>
</ul>
<h2>Saving a message</h2>
<p>First of all we want to setup a <a href="https://github.com/thomasdavis/backbonetutorials/blob/gh-pages/examples/nodejs-mongodb-mongoose-restify/templates/guestbook/form.html">template</a> for showing our form that creates new messages.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">textarea</span> <span class="kr">class</span><span class="o">=</span><span class="s2">"message"</span><span class="o">&gt;&lt;</span><span class="err">/textarea&gt;</span>
<span class="o">&lt;</span><span class="nx">button</span> <span class="kr">class</span><span class="o">=</span><span class="s2">"post-message"</span><span class="o">&gt;</span><span class="nx">Post</span> <span class="nx">Message</span><span class="o">&lt;</span><span class="err">/button&gt;</span></code></pre></div>
<p>This template gets inserted into the DOM by <code>views/guestbook/form.js</code>, this Backbone view also handles the interaction of the form and the posting of the new data.</p>
<p>Let us create a Backbone Model that has the correct URL for our restful interface.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">define</span><span class="p">([</span>
  <span class="s1">'underscore'</span><span class="p">,</span>
  <span class="s1">'backbone'</span>
<span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">Backbone</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">Message</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
      <span class="nx">url</span><span class="o">:</span> <span class="s1">'http://localhost:8080/messages'</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="nx">Message</span><span class="p">;</span>
<span class="p">});</span></code></pre></div>
<p>We can see how we require our predefined model for messages and also our form template.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">define</span><span class="p">([</span>
  <span class="s1">'jquery'</span><span class="p">,</span>
  <span class="s1">'underscore'</span><span class="p">,</span>
  <span class="s1">'backbone'</span><span class="p">,</span>
  <span class="s1">'models/message'</span><span class="p">,</span>
  <span class="s1">'text!templates/guestbook/form.html'</span>
<span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">Backbone</span><span class="p">,</span> <span class="nx">MessageModel</span><span class="p">,</span> <span class="nx">guestbookFormTemplate</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">GuestbookForm</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">el</span><span class="o">:</span> <span class="s1">'.guestbook-form-container'</span><span class="p">,</span>
    <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">guestbookFormTemplate</span><span class="p">);</span>
      
    <span class="p">},</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
      <span class="s1">'click .post-message'</span><span class="o">:</span> <span class="s1">'postMessage'</span>
    <span class="p">},</span>
    <span class="nx">postMessage</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MessageModel</span><span class="p">();</span>
      <span class="nx">message</span><span class="p">.</span><span class="nx">save</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'.message'</span><span class="p">).</span><span class="nx">val</span><span class="p">()},</span> <span class="p">{</span>
        <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="nx">that</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">'postMessage'</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="nx">GuestbookForm</span><span class="p">;</span>
<span class="p">});</span></code></pre></div>
<p><em>Note: <code>trigger</code> is from Backbone Events, I binded a listener to this view in <code>views/dashboard/page.js</code> so when a new message is submitted, the list is re-rendered. We are setting the date of the POST on the server so there is no need to pass it up.</em></p>
<h2>Retrieving a list of messages</h2>
<p>We setup a route on our server to generate a list of all available messages at <code>GET /messages</code>. So we need to define a collection with the appropriate <code>url</code> to fetch this data down.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">define</span><span class="p">([</span>
  <span class="s1">'jquery'</span><span class="p">,</span>
  <span class="s1">'underscore'</span><span class="p">,</span>
  <span class="s1">'backbone'</span><span class="p">,</span>
  <span class="s1">'models/message'</span>
<span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">Backbone</span><span class="p">,</span> <span class="nx">MessageModel</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">Messages</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">model</span><span class="o">:</span> <span class="nx">MessageModel</span><span class="p">,</span> <span class="c1">// Generally best practise to bring down a Model/Schema for your collection</span>
    <span class="nx">url</span><span class="o">:</span> <span class="s1">'http://localhost:8080/messages'</span>
  <span class="p">});</span>

  <span class="k">return</span> <span class="nx">Messages</span><span class="p">;</span>
<span class="p">});</span></code></pre></div>
<p>Now that we have a collection to use we can setup our <code>views/list.js</code> to require the collection and trigger a fetch. Once the fetch is complete we want to render our returned data to a template and insert it into the DOM.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">define</span><span class="p">([</span>
  <span class="s1">'jquery'</span><span class="p">,</span>
  <span class="s1">'underscore'</span><span class="p">,</span>
  <span class="s1">'backbone'</span><span class="p">,</span>
  <span class="s1">'collections/messages'</span><span class="p">,</span>
  <span class="s1">'text!templates/guestbook/list.html'</span>
<span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">Backbone</span><span class="p">,</span> <span class="nx">MessagesCollection</span><span class="p">,</span> <span class="nx">guestbookListTemplate</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">GuestbookList</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">el</span><span class="o">:</span> <span class="s1">'.guestbook-list-container'</span><span class="p">,</span>
    <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">messages</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MessagesCollection</span><span class="p">();</span>
      <span class="nx">messages</span><span class="p">.</span><span class="nx">fetch</span><span class="p">({</span>
        <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">messages</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">$</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">guestbookListTemplate</span><span class="p">,</span> <span class="p">{</span><span class="nx">messages</span><span class="o">:</span> <span class="nx">messages</span><span class="p">.</span><span class="nx">models</span><span class="p">,</span> <span class="nx">_</span><span class="o">:</span><span class="nx">_</span><span class="p">}));</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="nx">GuestbookList</span><span class="p">;</span>
<span class="p">});</span></code></pre></div>
<p>The template file should iterate over <code>messages.models</code> which is an array and print out a HTML fragment for each model.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;%</span> <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">messages</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span> <span class="o">%&gt;</span>

<span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;&lt;%=</span> <span class="nx">message</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'message'</span><span class="p">)</span> <span class="o">%&gt;&lt;</span><span class="err">/p&gt;</span>
<span class="o">&lt;</span><span class="nx">em</span><span class="o">&gt;&lt;%=</span> <span class="nx">message</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'date'</span><span class="p">)</span> <span class="o">%&gt;&lt;</span><span class="err">/em&gt;</span>

<span class="o">&lt;%</span> <span class="p">});</span> <span class="o">%&gt;</span></code></pre></div>
<p>This actually sums up everything you need to know to implement this simple example.</p>
<h2>Conclusion</h2>
<p><a href="https://github.com/thomasdavis/backbonetutorials/tree/gh-pages/examples/nodejs-mongodb-mongoose-restify">Example Codebase</a></p>
<p><a href="http://backbonetutorials.com/examples/nodejs-mongodb-mongoose-restify/app">Example Demo</a></p>
<p>In this example you should really be using relative URL's in your collections/models and instead setting a baseUrl in a config file or by placing your index.html file on the restful server.</p>
<p>This example is hosted on GitHub therefore we had to include the absolute URL to the server which is hosted on nodejitsu.com</p>
<p>On a personal note, I have of recent used the Joyent, Nodejitsu, MongoDbHq stack after they have now partnered up and I have nothing but good things to say. Highly recommend you check it out!</p>
<p>As always I hope I made this tutorial easy to follow!</p>
<p>Get in touch with me on twitter, comments or GitHub!</p>
<h3>Relevant Links</h3>
<p><a href="http://weblog.bocoup.com/organizing-your-backbone-js-application-with-modules">Organizing Your Backbone.js Application With Modules</a></p>
</div>
<hr>
<div class="row">
<div class="col-lg-4 col-lg-offset-4">
<div style="text-align: center;">
<img src="./node/cff733cf90823edd218a834980379c61" class="img-circle" style=" padding:2px; border: 1px solid #ddd; width: 100px;">
<h2>Thomas Davis</h2>
<p>Founder of <a href="http://cdnjs.com/">cdnjs.com</a>, <a href="http://jsonresume.org/">jsonresume.org</a></p>
<p>Work with Drones, Open Source, Tech Policy, Javascript and Music. </p>
<div class="addthis_horizontal_follow_toolbox" style="padding-left: 33px;"><div id="atftbx2" class="at-follow-tbx-element addthis-smartlayers addthis-animated at4-show"><p><span></span></p><div class="addthis_toolbox addthis_default_style addthis_32x32_style "><a class="addthis_button_facebook_follow at300b" data-svc="facebook" data-svc-id="pages/Thomas-Davis/1666997690193121" title="Follow on Facebook" href="http://www.facebook.com/pages/Thomas-Davis/1666997690193121" target="_blank"><span class="at4-icon-left at4-icon aticon-facebook" style="background-color:#305891;"><span class="at_a11y">Follow on Facebook</span></span><span class="addthis_follow_label">Facebook</span></a><a class="addthis_button_twitter_follow at300b" data-svc="twitter" data-svc-id="neutralthoughts" title="Follow on Twitter" href="http://twitter.com/intent/follow?source=followbutton&variant=1.0&screen_name=neutralthoughts" target="_blank"><span class="at4-icon-left at4-icon aticon-twitter" style="background-color:#2ca8d2;"><span class="at_a11y">Follow on Twitter</span></span><span class="addthis_follow_label">Twitter</span></a><a class="addthis_button_linkedin_follow at300b" data-svc="linkedin" data-svc-id="thomasalwyndavis" title="Follow on LinkedIn" href="http://www.linkedin.com/in/thomasalwyndavis" target="_blank"><span class="at4-icon-left at4-icon aticon-linkedin" style="background-color:#4498c8;"><span class="at_a11y">Follow on LinkedIn</span></span><span class="addthis_follow_label">LinkedIn</span></a><a class="addthis_button_google_follow_follow at300b" data-svc="google_follow" data-svc-id="101608559187380638042" title="Follow on Google" href="https://plus.google.com/101608559187380638042" target="_blank"><span class="at4-icon-left at4-icon aticon-google_follow" style="background-color:#CF4832;"><span class="at_a11y">Follow on Google</span></span><span class="addthis_follow_label">Google</span></a><a class="addthis_button_youtube_follow at300b" data-svc="youtube" data-svc-id="thomasalwyndavisj" title="Follow on Youtube" href="http://www.youtube.com/user/thomasalwyndavisj?sub_confirmation=1" target="_blank"><span class="at4-icon-left at4-icon aticon-youtube" style="background-color:#CC1F1F;"><span class="at_a11y">Follow on Youtube</span></span><span class="addthis_follow_label">Youtube</span></a><div class="atclear"></div></div></div></div>
<br>
<a href="https://github.com/thomasdavis">github.com/thomasdavis</a>
</div>
</div>
</div>
<hr>
<script type="text/rocketscript" data-rocketsrc="//s7.addthis.com/js/300/addthis_widget.js#pubid=thomasdavis" async="async" data-rocketoptimized="true"></script>
<div id="disqus_thread"><iframe id="dsq-2" data-disqus-uid="2" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./node/saved_resource.html" style="width: 100% !important; border: none !important; overflow: hidden !important; height: 7225px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></div>
<script type="text/rocketscript" data-rocketoptimized="true">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'bbtutes'; // required: replace example with your forum shortname
    var disqus_url = 'http://backbonetutorials.com/nodejs-restify-mongodb-mongoose';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
</div>
<script data-rocketsrc="//static.getclicky.com/js" type="text/rocketscript" data-rocketoptimized="true"></script>
<script type="text/rocketscript" data-rocketoptimized="true">try{ clicky.init(66406579); }catch(e){}</script>
<noscript>&lt;p&gt;&lt;img alt="Clicky" width="1" height="1" src="//in.getclicky.com/66406579ns.gif"/&gt;&lt;/p&gt;</noscript>


</div><div id="_atssh" style="visibility: hidden; height: 1px; width: 1px; position: absolute; top: -9999px; z-index: 100000;"><iframe id="_atssh999" title="AddThis utility frame" src="./node/sh189.html" style="height: 1px; width: 1px; position: absolute; top: 0px; z-index: 100000; border: 0px; left: 0px;"></iframe></div><script type="text/javascript" data-rocketsrc="http://s7.addthis.com/static/r07/core185.js" data-rocketoptimized="true"></script><script id="twitter-csp-test"></script><div class="at4-share-outer-right addthis-smartlayers addthis-smartlayers-desktop" aria-labelledby="at4-share-label" role="region"><div id="at4-share-label">AddThis Sharing</div><div id="at4-share" class="addthis_32x32_style atss atss-right addthis-animated slideInRight at4-show"><a class="at4-share-btn at-svc-facebook" href="http://backbonetutorials.com/nodejs-restify-mongodb-mongoose/#"><span class=" at4-icon aticon-facebook" title="Facebook">Facebook</span></a><a class="at4-share-btn at-svc-twitter" href="http://backbonetutorials.com/nodejs-restify-mongodb-mongoose/#"><span class=" at4-icon aticon-twitter" title="Twitter">Twitter</span></a><a class="at4-share-btn at-svc-email" href="http://backbonetutorials.com/nodejs-restify-mongodb-mongoose/#"><span class=" at4-icon aticon-email" title="Email">Email</span></a><a class="at4-share-btn at-svc-print" href="http://backbonetutorials.com/nodejs-restify-mongodb-mongoose/#"><span class=" at4-icon aticon-print" title="Print">Print</span></a><a class="at4-share-btn at-svc-compact" href="http://backbonetutorials.com/nodejs-restify-mongodb-mongoose/#"><span class=" at4-icon aticon-compact" title="More">More</span></a><div id="at4-scc" class="at-share-close-control ats-dark at4-show at4-hide-content" title="Hide"><div class="at4-arrow at-right">Hide</div></div></div><div id="at4-soc" class="at-share-open-control-right ats-dark at4-hide" title="Show" style="padding-right: 17px;"><div class="at4-arrow at-left">Show</div></div></div><div id="at4-thankyou" class="at4-thankyou at4-thankyou-background at4-hide ats-transparent at4-thankyou-desktop addthis-smartlayers addthis-animated fadeIn at4-show" role="dialog" aria-labelledby="at-thankyou-label"><div class="at4lb-inner"><a class="at4x" href="http://backbonetutorials.com/nodejs-restify-mongodb-mongoose/#" title="Close"></a><a id="at4-palogo" class="at4-logo" href="http://www.addthis.com/?utm_source=dynpo&utm_medium=img&utm_content=AT_main_WT&utm_campaign=AT_main" title="AddThis" target="_blank">AddThis</a><a id="at4-paprivacy" class="at4-privacy" href="http://www.addthis.com/privacy/privacy-policy" title="Privacy" target="_blank">Privacy</a><div class="at4-thankyou-inner"><div id="at-thankyou-label" class="thankyou-title"></div><div class="thankyou-description"></div><div class="at4-thankyou-layer"></div></div></div></div></body></html>